<!DOCTYPE html>
<html lang="id">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta charset="UTF-8">
<title>Form Pengeluaran Sparepart</title>

<style>
body{
  font-family: Calibri, Arial, sans-serif;
  background:#f2f2f2;
  padding:12px;
  margin:0;
}
.table-container{
  width:100%;
  overflow-x:auto;
  margin-bottom:16px;
}
table{
  border-collapse:collapse;
  width:100%;
  background:#fff;
  font-size:16px;
}
td{
  border:1px solid #333;
  padding:6px;
}
.label{
  background:#cce5ff;
  font-weight:bold;
  width:35%;
}
input,select,textarea{
  width:100%;
  padding:6px;
  box-sizing:border-box;
  font-size:14px;
}
.upper{ text-transform:uppercase; }
textarea{ resize:vertical; }
button{
  padding:10px 15px;
  margin-right:8px;
  margin-top:8px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.add{ background:#28a745; color:#fff; }
.gen{ background:#ffc107; }
.copy{ background:#007bff; color:#fff; }
pre{
  background:#fff;
  border:1px solid #333;
  padding:12px;
  white-space:pre-wrap;
}
.inline{
  display:flex;
  gap:5px;
}
</style>
</head>

<body>

<h2>Input Pengeluaran Sparepart</h2>

<div id="forms"></div>

<button class="add" onclick="addForm()">âž• Tambah Invoice</button>
<button class="gen" onclick="generate()">Generate</button>

<pre id="output"></pre>
<button class="copy" onclick="copyText()">Copy</button>

<script>
function addForm(){
  const div=document.createElement('div');
  div.classList.add('table-container');
  div.innerHTML=`
<table>
<tr>
<td class="label">Tanggal Pengeluaran</td>
<td><input class="upper" placeholder="29 JANUARI 2026"></td>
</tr>

<tr>
<td class="label">Plat Nomor</td>
<td><input class="upper"></td>
</tr>

<tr>
<td class="label">Divisi</td>
<td>
<select>
<option value="">PILIH</option>
<option>BIP</option>
<option>TIP</option>
<option>IPLS</option>
</select>
</td>
</tr>

<tr>
<td class="label">Invoice</td>
<td><input class="upper"></td>
</tr>

<tr>
<td class="label">KM</td>
<td><input class="upper" placeholder="Kilometer ODO"></td>
</tr>

<tr>
<td class="label">Keterangan</td>
<td class="inline">
<input>
<select onchange="autoFill(this)">
<option value="NORMAL">Normal</option>
<option value="BAN">Ban</option>
<option value="FHINO4">F. Hino Euro 4</option>
<option value="FHINO2">F. Hino Euro 2</option>
<option value="FUSOINT">Fuso Interkuler</option>
<option value="FUSO4">Fuso Fighter Euro 4</option>
</select>
</td>
</tr>

<tr>
<td class="label">List Barang</td>
<td>
<textarea rows="4" placeholder="CONTOH: Nama Barang : 1 p"></textarea>
</td>
</tr>
</table>`;
  document.getElementById('forms').appendChild(div);
}
addForm();

/* ===== AUTOFILL BARANG ===== */
function autoFill(el){
  const table = el.closest('table');
  const textarea = table.rows[6].cells[1].children[0];
  let data = '';

  switch(el.value){
    case 'FHINO4':
      data =
`F/F Hop (JAE51) : 1 P
F/F Hop (JAF20) : 1 P
F/F Hop (JAF40) : 1 P
F/O Hop (JAA10) : 1 P`;
      break;

    case 'FHINO2':
      data =
`F/F Hop (LAA10) : 1 P
F/F Hop (JAC70) : 1 P
F/O Hop (JAA10) : 1 P`;
      break;

    case 'FUSOINT':
      data =
`F/F Sakura (Fc 1005) : 1 P
F/O Sakura (O-1012-S) : 1 P`;
      break;

    case 'FUSO4':
      data =
`F/F Sakura (FC 1003) : 1 P
F/F Sakura (EF 10090) : 1 P
F/F Sakura (EF 10100) : 1 P
F/O Sakura (C-6105) : 1 P`;
      break;

    default:
      return;
  }

  textarea.value = data;
}

/* FORMAT ITEM */
function formatItem(line){
  return line
    .replace(/\b(\d+)\s*p\b/i,'$1 Pcs')
    .replace(/\b(\d+)\s*s\b/i,'$1 Set')
    .replace(/\b(\d+)\s*b\b/i,'$1 Btl')
    .replace(/\b(\d+)\s*l\b/i,'$1 Ltr')
    .replace(/\b(\d+)\s*r\b/i,'$1 Roll');
}

/* GENERATE */
function generate(){
  let res='';
  document.querySelectorAll('#forms table').forEach(t=>{
    const tanggal=t.rows[0].cells[1].children[0].value.trim().toUpperCase();
    const plat=t.rows[1].cells[1].children[0].value.trim().toUpperCase();
    const div=t.rows[2].cells[1].children[0].value;
    const inv=t.rows[3].cells[1].children[0].value.trim().toUpperCase();
    const km=t.rows[4].cells[1].children[0].value.trim();
    const ket=t.rows[5].cells[1].children[0].value.trim();
    const ketType=t.rows[5].cells[1].children[1].value;
    const items=t.rows[6].cells[1].children[0].value.trim();

    if(!plat||!div||!inv) return;

    if(tanggal){
      res+=`PENGELUARAN SPAREPART ${tanggal}\n\n`;
    }

    res+=`*${plat}* (${div})\n`;
    res+=`*#${inv}*`;
    if(km) res+=` (KM ${km})`;
    res+=`\n`;

    if(ket) res+=`${ket}\n`;

    if(items){
      items.split('\n').forEach(i=>{
        if(!i.trim()) return;
        if(ketType==="BAN" && i.toUpperCase()==="BB BALIK"){
          res+=`BB BALIK\n`;
        }else{
          res+=`- ${formatItem(i)}\n`;
        }
      });
    }
    res+=`\n`;
  });
  document.getElementById('output').textContent=res.trim();
}

function copyText(){
  navigator.clipboard.writeText(document.getElementById('output').textContent);
  alert('Berhasil di-copy');
}
</script>

</body>
</html>
