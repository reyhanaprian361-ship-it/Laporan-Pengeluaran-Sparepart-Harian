<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Form Pengeluaran Sparepart</title>
<style>
body{
  font-family:Calibri, Arial, sans-serif;
  background:#f2f2f2;
  padding:20px;
}
table{
  border-collapse:collapse;
  width:500px;
  margin-bottom:25px;
  background:#fff;
}
td{
  border:1px solid #333;
  padding:8px;
}
.label{
  background:#cce5ff;
  font-weight:bold;
  width:180px;
}
input, select, textarea{
  width:100%;
  padding:6px;
  box-sizing:border-box;
}
.upper{
  text-transform:uppercase;
}
textarea{
  resize:vertical;
}
button{
  padding:10px 15px;
  margin-right:10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.add{background:#28a745;color:#fff;}
.gen{background:#ffc107;}
.copy{background:#007bff;color:#fff;}
pre{
  background:#fff;
  border:1px solid #333;
  padding:15px;
  white-space:pre-wrap;
}
.inline{
  display:flex;
  gap:5px;
}
</style>
</head>

<body>

<h2>Input Pengeluaran Sparepart</h2>

<div id="forms"></div>

<button class="add" onclick="addForm()">âž• Tambah Invoice</button>
<button class="gen" onclick="generate()">Generate</button>

<pre id="output"></pre>
<button class="copy" onclick="copyText()">Copy</button>

<script>
function addForm(){
  const div = document.createElement('div');
  div.innerHTML = `
<table>

<tr>
<td class="label">Tanggal Pengeluaran</td>
<td><input class="upper" placeholder="29 JANUARI 2026"></td>
</tr>

<tr>
<td class="label">Plat Nomor</td>
<td><input class="upper"></td>
</tr>

<tr>
<td class="label">Divisi</td>
<td>
<select>
<option value="">PILIH</option>
<option>BIP</option>
<option>TIP</option>
<option>IPLS</option>
</select>
</td>
</tr>

<tr>
<td class="label">Invoice</td>
<td><input class="upper"></td>
</tr>

<tr>
<td class="label">KM</td>
<td><input class="upper" placeholder="ANGKA SAJA"></td>
</tr>

<tr>
<td class="label">Keterangan</td>
<td class="inline">
<input>
<select>
<option value="NORMAL">Normal</option>
<option value="BAN">Ban</option>
</select>
</td>
</tr>

<tr>
<td class="label">List Barang</td>
<td><textarea rows="4" placeholder="CONTOH: BAN : 2 p"></textarea></td>
</tr>

</table>`;
  document.getElementById('forms').appendChild(div);
}
addForm();

// FORMAT ITEM
function formatItem(line){
  return line
    .replace(/\b(\d+)\s*p\b/i, '$1 PCS')
    .replace(/\b(\d+)\s*s\b/i, '$1 SET')
    .replace(/\b(\d+)\s*b\b/i, '$1 BTL')
    .replace(/\b(\d+)\s*r\b/i, '$1 ROLL');
}

// GENERATE
function generate(){
  let res='';
  document.querySelectorAll('#forms table').forEach(t=>{
    const tanggal = t.rows[0].cells[1].children[0].value.trim().toUpperCase();
    const plat = t.rows[1].cells[1].children[0].value.trim().toUpperCase();
    const div = t.rows[2].cells[1].children[0].value;
    const inv = t.rows[3].cells[1].children[0].value.trim().toUpperCase();
    const km = t.rows[4].cells[1].children[0].value.trim();
    const ket = t.rows[5].cells[1].children[0].value.trim();
    const ketType = t.rows[5].cells[1].children[1].value;
    const items = t.rows[6].cells[1].children[0].value.trim();

    if(!plat || !div || !inv) return;

    if(tanggal){
      res += `PENGELUARAN SPAREPART ${tanggal}\n\n`;
    }

    res += `*${plat}* (${div})\n`;
    res += `*#${inv}*`;
    if(km) res += ` (KM ${km})`;
    res += `\n`;

    if(ket) res += `${ket}\n`;

    if(items){
      items.split('\n').forEach(i=>{
        const line=i.trim();
        if(!line) return;

        if(ketType==="BAN" && line.toUpperCase()==="BB BALIK"){
          res += `BB BALIK\n`;
        }else{
          res += `- ${formatItem(line)}\n`;
        }
      });
    }

    res += `\n`;
  });

  document.getElementById('output').textContent = res.trim();
}

function copyText(){
  navigator.clipboard.writeText(document.getElementById('output').textContent);
  alert('Berhasil di-copy');
}
</script>

</body>
</html>